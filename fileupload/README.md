# 이미지, 영상 업로드를 위한 서버

## goal
1. webflux를 이용한 비동기 업로드 서버
2. 영상 파일 인코딩을 통한 효율적 저장


## 고민점

### 1. 메인 서버와 별도로 분리된 서버
- 어떻게 jwt를 통한 인증을 처리할 것인가
  - 메인 서버에서 jwt 토큰을 검증하는 api를 만든다.
  - 업로드 서버로 들어온 jwt 토큰을 메인 서버의 검증 api를 통해 검증한다.
  - webfilter 단에서 검증한다.


### 2. 용량이 큰 영상 파일을 어떻게 인코딩해 효율적으로 처리할 것인가
- 인코딩은 FFmpeg 라이브러리를 사용.
- scheduler를 통해 별도의 스레드를 만들어 거기서 인코딩 처리.
- validator 인터페이스를 구현해서 유효성검증

### 3. 파일을 어디에 저장할 것인가
- S3의 외부 서비스를 이용 혹은 업로드 서버가 올라갈 ec2 로컬에 저장하는 방식

### 4. 파일을 저장하고 db에 어떤 내용을 넣을 것인가
업로드 서버는 업로드만 처리하자. 사용자가 파일을 업로드 하면 서버에서 업로드 처리 후 파일 url, 파일명을 리턴 
클라이언트에서는 해당 url을 받아 게시글 작성 시 함께 리퀘스트
게시글 작성 api 서버는 db에 아래의 정보를 입력
- 파일을 올린 유저(user pk)
- 어떤 게시글의 파일인가(article pk)
- 파일명(UUID)
- 파일의 타입이 무엇인가(유형 및 확장자)
- 파일 경로 또는 URL
- 현재 상태 (이용가능, 삭제)
- 업로드 시간
- 설명 혹은 태그(검색, 관리 용이성)

